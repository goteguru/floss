#!/bin/bash

#
# (re)Generate section 2 additional results md files 
#

MYDIR=$(dirname $0)
FLOSS_DATA_DIR=${FLOSS_DATA_DIR-"$MYDIR/../../adatok/"}
FLOSS_PUB_DIR=${FLOSS_PUB_DIR-"$MYDIR/../"}
FLOSS_DB=$FLOSS_DATA_DIR/floss.sqlite
TARGET_DIR=$FLOSS_PUB_DIR/F2_FOSS_Sajátosságok/

if [ ! -f $FLOSS_DB ]; then
	echo "$FLOSS_DB not found. Please run db create script (adat/floss)".
	exit 1
fi


for code in J H F M K G T S ; do
>$TARGET_DIR/${code}_XTables.md sqlite3 $FLOSS_DB <<SQL
.separator |
SELECT ":A *$code* kategóriában azonosított problémák";
SELECT "";
SELECT "kód |szint|leírás                                                                            | sajátosság";
SELECT "---:|:--:|:---------------------------------------------------------------------------------|---------------";
SELECT * FROM vulnerability WHERE vid LIKE "S$code%";
SELECT "";
SELECT ":A *$code* kategóriában azonosított javaslatok";
SELECT "";
SELECT "kód |szint|leírás                                                                            | probléma"; 
SELECT "---:|:--:|:---------------------------------------------------------------------------------|---------------";
SELECT mid,lev,des,group_concat(vid,', ') FROM mitigation LEFT JOIN m2v using (mid) WHERE mid like 'J$code%' GROUP BY mid;
SQL
done
